---
title: Lab1
date: 2024-02-13 23:33:00 +/-0000
categories: [Lab Reports, Lab1]
tags: [Lab1]     # TAG names should always be lowercase
math: true
author: 1
mermaid: true
pin: true
---

# Lab 1

## Prelab Setup

After we uploaded the ***ble_arduino.ino*** into our Artemis, the MAC address of our Artemis was automatically printed it out because of the ***Setup()*** function.

![BLE MAC Address](/assets/images/lab1/ble_MAC.png "Arduino IDE prints BLE MAC Address")

When we updated our Artemis MAC address in the *connection.yml* file, we can connect our computer with the Artemis by bluetooth. We can send the commands from our computer in the Python file by using the bluetooth as the bridge to our board. The connection is shown:

![BLE Connection Success](/assets/images/lab1/ble_connection_success.png "Our computer successfully connects the Artemis board")

## Lab Tasks

### Task 1

This task required sending an ECHO command with a string value from the computer to the board and receiving the augmented string. For the Artemis, I implemented a command case named ***ECHO***. First, checked whether the string length exceeds the maximum length limit, and then appended the extra words to the string, and sent back finally.

![echo command](/assets/images/lab1/echo_command.png "echo command implementation")

On the computer, after the command code was loaded for the board, ran the ECHO command in the ***demo.ipynb*** and got the echo output:

![echo command output](/assets/images/lab1/echo_command_output.png "echo command output")

### Task 2

This task required the implementation of the command ***GET_TIME_MILLIS*** and receiving the time string from the board. I created a case command ***GET_TIME_MILLIS***, and implemented it by concatenating the strings together and used the *writeValue()* function to send the completer string back to the computer.

![Get Time Millis](/assets/images/lab1/GET_TIME_MILLIS.png "get time millis")

And ran the command in ***demo.ipynb*** and get the return output:

![Get Time Millis Output](/assets/images/lab1/GET_TIME_MILLIS_output.png "get time millis output")

### Task 3

The task required implementing an asynchronous function in our ***demolipynb*** to serve as the notification handler to receive string values from the board. First defined an empty global array variable ***time_stamps*** to store the time stamps. Second, we got the string messages from the board and strip the first two elements which should be "T:" here. Then, we appended the pure time value into the ***time_stamps*** array. We "started" the handler and tested it by sending "PONG" and a time string, and got the expected striped output.

![time handler](/assets/images/lab1/time_handler.png "time handler")

### Task 4

The task required continuously sending the millisecond timestamp and getting received by the handler and estimating the data transfer rate. Here, I defined a case for Artemis called ***SEND_TIME_STAMPS*** to continuously send messages for 4000ms:

![Send Time Stamps](/assets/images/lab1/SEND_TIME_STAMPS.png "send time stamps")

Then, I received the data and stored them after the handler function processed those data. And based on the number of collected data and the time duration, calculated the data rate:

![Time Stamps data](/assets/images/lab1/SEND_TIME_STAMPS_data.png "time stamps data")
![time stamps data rate](/assets/images/lab1/time_stamps_data_rate.png "data transfer rate")

### Task 5

This task required us to store the time stamps first and after all the stamps were collected, then send those time stamps back one by one. This task was different with ***Task 4*** which was generating one stamp and sent back immediately. For this task, I defined a global variable in ***ble_arduino.ino*** as ***char* timeStamps[50]*** and I recorded 50 stamps in total. I also added a case command named ***ADD_TIME_STAMPS*** to create dynamic string arrays and store the stamps. Also, I used ***timeStamps_new_status*** to record whether the array had elements inside to avoid overwritten.

![Add Time Stamps](/assets/images/lab1/ADD_TIME_STAMPS.png "Add Time Stamps")

Then, we defined ***SEND_TIME_DATA*** to loop over the ***timeStamps*** array to send back the stamps. Meanwhile, deleted all the dynamic memory to avoid memory leak. I got the same time values from both the board output and our computer output, where our computer already processed the data to keep the numerical value.

![Send Time Data](/assets/images/lab1/SEND_TIME_DATA.png "Send time data")
![Send Time Data output from Arduino](/assets/images/lab1/SEND_TIME_DATA_ino.png "Send time data output from Arduino")

